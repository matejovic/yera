{
  "version": 3,
  "sources": ["../../preact-iso/src/router.js", "../../preact-iso/src/lazy.js", "../../preact-iso/src/hydrate.js", "../../preact-iso/src/index.js"],
  "sourcesContent": ["import { h, createContext, cloneElement, toChildArray } from 'preact';\nimport { useContext, useMemo, useReducer, useLayoutEffect, useRef } from 'preact/hooks';\n\nlet push;\nconst UPDATE = (state, url) => {\n\tpush = undefined;\n\tif (url && url.type === 'click') {\n\t\t// ignore events the browser takes care of already:\n\t\tif (url.ctrlKey || url.metaKey || url.altKey || url.shiftKey || url.button !== 0) {\n\t\t\treturn state;\n\t\t}\n\n\t\tconst link = url.target.closest('a[href]');\n\t\tif (\n\t\t\t!link ||\n\t\t\tlink.origin != location.origin ||\n\t\t\t/^#/.test(link.getAttribute('href')) ||\n\t\t\t!/^(_?self)?$/i.test(link.target)\n\t\t) {\n\t\t\treturn state;\n\t\t}\n\n\t\tpush = true;\n\t\turl.preventDefault();\n\t\turl = link.href.replace(location.origin, '');\n\t} else if (typeof url === 'string') {\n\t\tpush = true;\n\t} else {\n\t\turl = location.pathname + location.search;\n\t}\n\n\tif (push === true) history.pushState(null, '', url);\n\telse if (push === false) history.replaceState(null, '', url);\n\treturn url;\n};\n\nexport const exec = (url, route, matches) => {\n\turl = url.split('/').filter(Boolean);\n\troute = (route || '').split('/').filter(Boolean);\n\tfor (let i = 0, val, rest; i < Math.max(url.length, route.length); i++) {\n\t\tlet [, m, param, flag] = (route[i] || '').match(/^(:?)(.*?)([+*?]?)$/);\n\t\tval = url[i];\n\t\t// segment match:\n\t\tif (!m && param == val) continue;\n\t\t// /foo/* match\n\t\tif (!m && val && flag == '*') {\n\t\t\tmatches.rest = '/' + url.slice(i).map(decodeURIComponent).join('/');\n\t\t\tbreak;\n\t\t}\n\t\t// segment mismatch / missing required field:\n\t\tif (!m || (!val && flag != '?' && flag != '*')) return;\n\t\trest = flag == '+' || flag == '*';\n\t\t// rest (+/*) match:\n\t\tif (rest) val = url.slice(i).map(decodeURIComponent).join('/');\n\t\t// normal/optional field:\n\t\telse if (val) val = decodeURIComponent(val);\n\t\tmatches.params[param] = val;\n\t\tif (!(param in matches)) matches[param] = val;\n\t\tif (rest) break;\n\t}\n\treturn matches;\n};\n\nexport function LocationProvider(props) {\n\tconst [url, route] = useReducer(UPDATE, props.url || location.pathname + location.search);\n\tconst wasPush = push === true;\n\n\tconst value = useMemo(() => {\n\t\tconst u = new URL(url, location.origin);\n\t\tconst path = u.pathname.replace(/(.)\\/$/g, '$1');\n\t\t// @ts-ignore-next\n\t\treturn { url, path, query: Object.fromEntries(u.searchParams), route, wasPush };\n\t}, [url]);\n\n\tuseLayoutEffect(() => {\n\t\taddEventListener('click', route);\n\t\taddEventListener('popstate', route);\n\n\t\treturn () => {\n\t\t\tremoveEventListener('click', route);\n\t\t\tremoveEventListener('popstate', route);\n\t\t};\n\t}, []);\n\n\t// @ts-ignore\n\treturn h(LocationProvider.ctx.Provider, { value }, props.children);\n}\n\nconst RESOLVED = Promise.resolve();\nexport function Router(props) {\n\tconst [c, update] = useReducer(c => c + 1, 0);\n\n\tconst { url, query, wasPush, path } = useLocation();\n\tconst { rest = path, params = {} } = useContext(RouteContext);\n\n\tconst isLoading = useRef(false);\n\tconst prevRoute = useRef(path);\n\t// Monotonic counter used to check if an un-suspending route is still the current route:\n\tconst count = useRef(0);\n\t// The current route:\n\tconst cur = useRef();\n\t// Previous route (if current route is suspended):\n\tconst prev = useRef();\n\t// A not-yet-hydrated DOM root to remove once we commit:\n\tconst pendingBase = useRef();\n\t// has this component ever successfully rendered without suspending:\n\tconst hasEverCommitted = useRef(false);\n\t// was the most recent render successful (did not suspend):\n\tconst didSuspend = useRef();\n\tdidSuspend.current = false;\n\n\tcur.current = useMemo(() => {\n\t\t// This hack prevents Preact from diffing when we swap `cur` to `prev`:\n\t\tif (this.__v && this.__v.__k) this.__v.__k.reverse();\n\n\t\tcount.current++;\n\n\t\tprev.current = cur.current;\n\n\t\tlet p, d, m;\n\t\ttoChildArray(props.children).some(vnode => {\n\t\t\tconst matches = exec(rest, vnode.props.path, (m = { path: rest, query, params, rest: '' }));\n\t\t\tif (matches) return (p = cloneElement(vnode, m));\n\t\t\tif (vnode.props.default) d = cloneElement(vnode, m);\n\t\t});\n\n\t\treturn h(RouteContext.Provider, { value: m }, p || d);\n\t}, [url]);\n\n\t// Reset previous children - if rendering succeeds synchronously, we shouldn't render the previous children.\n\tconst p = prev.current;\n\tprev.current = null;\n\n\t// This borrows the _childDidSuspend() solution from compat.\n\tthis.__c = e => {\n\t\t// Mark the current render as having suspended:\n\t\tdidSuspend.current = true;\n\n\t\t// The new route suspended, so keep the previous route around while it loads:\n\t\tprev.current = p;\n\n\t\t// Fire an event saying we're waiting for the route:\n\t\tif (props.onLoadStart) props.onLoadStart(url);\n\t\tisLoading.current = true;\n\n\t\t// Re-render on unsuspend:\n\t\tlet c = count.current;\n\t\te.then(() => {\n\t\t\t// Ignore this update if it isn't the most recently suspended update:\n\t\t\tif (c !== count.current) return;\n\n\t\t\t// Successful route transition: un-suspend after a tick and stop rendering the old route:\n\t\t\tprev.current = null;\n\t\t\tRESOLVED.then(update);\n\t\t});\n\t};\n\n\tuseLayoutEffect(() => {\n\t\tconst currentDom = this.__v && this.__v.__e;\n\n\t\t// Ignore suspended renders (failed commits):\n\t\tif (didSuspend.current) {\n\t\t\t// If we've never committed, mark any hydration DOM for removal on the next commit:\n\t\t\tif (!hasEverCommitted.current && !pendingBase.current) {\n\t\t\t\tpendingBase.current = currentDom;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// If this is the first ever successful commit and we didn't use the hydration DOM, remove it:\n\t\tif (!hasEverCommitted.current && pendingBase.current) {\n\t\t\tif (pendingBase.current !== currentDom) pendingBase.current.remove();\n\t\t\tpendingBase.current = null;\n\t\t}\n\n\t\t// Mark the component has having committed:\n\t\thasEverCommitted.current = true;\n\n\t\t// The route is loaded and rendered.\n\t\tif (prevRoute.current !== path) {\n\t\t\tif (wasPush) scrollTo(0, 0);\n\t\t\tif (props.onLoadEnd && isLoading.current) props.onLoadEnd(url);\n\t\t\tif (props.onRouteChange) props.onRouteChange(url);\n\n\t\t\tisLoading.current = false;\n\t\t\tprevRoute.current = path;\n\t\t}\n\t}, [path, wasPush, c]);\n\n\t// Note: curChildren MUST render first in order to set didSuspend & prev.\n\treturn [h(RenderRef, { r: cur }), h(RenderRef, { r: prev })];\n}\n\n// Lazily render a ref's current value:\nconst RenderRef = ({ r }) => r.current;\n\nRouter.Provider = LocationProvider;\n\n/** @typedef {{ url: string, path: string, query: object, route, wasPush: boolean }} RouteInfo */\n\nLocationProvider.ctx = createContext(/** @type {RouteInfo} */ ({}));\nconst RouteContext = createContext({});\n\nexport const Route = props => h(props.component, props);\n\nexport const useLocation = () => useContext(LocationProvider.ctx);\nexport const useRoute = () => useContext(RouteContext);\n", "import { h, options } from 'preact';\nimport { useState, useRef } from 'preact/hooks';\n\nexport default function lazy(load) {\n\tlet p, c;\n\treturn props => {\n\t\tconst [, update] = useState(0);\n\t\tconst r = useRef(c);\n\t\tif (!p) p = load().then(m => (c = (m && m.default) || m));\n\t\tif (c !== undefined) return h(c, props);\n\t\tif (!r.current) r.current = p.then(() => update(1));\n\t\tthrow p;\n\t};\n}\n\n// See https://github.com/preactjs/preact/blob/88680e91ec0d5fc29d38554a3e122b10824636b6/compat/src/suspense.js#L5\nconst oldCatchError = options.__e;\noptions.__e = (err, newVNode, oldVNode) => {\n\tif (err && err.then) {\n\t\tlet v = newVNode;\n\t\twhile ((v = v.__)) {\n\t\t\tif (v.__c && v.__c.__c) {\n\t\t\t\tif (newVNode.__e == null) {\n\t\t\t\t\tnewVNode.__e = oldVNode.__e; // ._dom\n\t\t\t\t\tnewVNode.__k = oldVNode.__k; // ._children\n\t\t\t\t}\n\t\t\t\tif (!newVNode.__k) newVNode.__k = [];\n\t\t\t\treturn v.__c.__c(err, newVNode);\n\t\t\t}\n\t\t}\n\t}\n\tif (oldCatchError) oldCatchError(err, newVNode, oldVNode);\n};\n\nexport function ErrorBoundary(props) {\n\tthis.__c = childDidSuspend;\n\tthis.componentDidCatch = props.onError;\n\treturn props.children;\n}\n\nfunction childDidSuspend(err) {\n\terr.then(() => this.forceUpdate());\n}\n", "import { render, hydrate as hydrativeRender } from 'preact';\n\nlet initialized;\n\n/** @type {typeof render} */\nexport default function hydrate(jsx, parent) {\n\tif (typeof window === 'undefined') return;\n\tlet isodata = document.querySelector('script[type=isodata]');\n\t// @ts-ignore-next\n\tparent = parent || (isodata && isodata.parentNode) || document.body;\n\tif (!initialized && isodata) {\n\t\thydrativeRender(jsx, parent);\n\t} else {\n\t\trender(jsx, parent);\n\t}\n\tinitialized = true;\n}\n", "export { Router, LocationProvider, useLocation, Route, useRoute } from './router.js';\nexport { default as lazy, ErrorBoundary } from './lazy.js';\nexport { default as hydrate } from './hydrate.js';\n\nexport function prerender(vnode, options) {\n\treturn import('./prerender.js').then(m => m.default(vnode, options));\n}\n"],
  "mappings": "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",
  "names": ["F", "y", "c", "p"]
}
